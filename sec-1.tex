\part{源代码管理}
\begin{frame}[<+->]{引子}
\begin{itemize}
  \item 没有源代码管理的世界
  \item 修订控制/版本管理
  \item 谁需要源代码管理
  \item 使用源代码管理的代价
  \item 使用源代码管理的好处
  \item 有哪些源代码管理工具
\end{itemize}
\end{frame}

\part{独自使用Git的情景}
\begin{frame}[<+->][fragile]{安装Git}
\begin{itemize}
  \item Linux下的安装
  不必废话
\begin{Verbatim}[frame=single,commandchars=\\\{\}]
sudo apt-get install git-core
\end{Verbatim}

  \item Windows下
  使用msisgit
\end{itemize}
\end{frame}

\begin{frame}[<+->][fragile]{配置}
\begin{Verbatim}[frame=single,commandchars=\\\{\}]
git config --global user.name "Your Name"
git config --global user.email "you@example.com"
git config --global core.editor vim
git config --global core.quotepash false
\end{Verbatim}
\end{frame}

\begin{frame}[<+->][fragile]{用起来}
\onslide<+->
新建一个项目
\begin{Verbatim}[frame=single,commandchars=\\\{\}]
mkdir xproj
cd xproj
vi main.c
\end{Verbatim}

\onslide<+->
为这个项目建立一个Git仓库并提交第一个版本
\begin{Verbatim}[frame=single,commandchars=\\\{\}]
git init
git add .
git commit -m 'The first of first commit.'
\end{Verbatim}
\end{frame}

\begin{frame}[<+->][fragile]{修改与提交}
\onslide<+->
修改一些内容
\begin{Verbatim}[frame=single,commandchars=\\\{\}]
vi main.c
\end{Verbatim}

\onslide<+->
查看状态，提交修改
\begin{Verbatim}[frame=single,commandchars=\\\{\}]
git status
git commit -a -m 'Loop 70 times, then exit.'
\end{Verbatim}
\end{frame}

\begin{frame}[<+->][fragile]{增加文件}
\onslide<+->
增加两个文件
\begin{Verbatim}[frame=single,commandchars=\\\{\}]
vi common.c
vi common.h
\end{Verbatim}

\onslide<+->
加到Git仓库中
\begin{Verbatim}[frame=single,commandchars=\\\{\}]
git status
git add common.c common.h
git commit -m 'Two files common.[ch] are added.'
\end{Verbatim}
\end{frame}

\begin{frame}[<+->][fragile]{重新来过}
\onslide<+->
继续修改文件
\begin{Verbatim}[frame=single,commandchars=\\\{\}]
vi main.c
vi common.c
\end{Verbatim}

\onslide<+->
忘记了修改过哪些文件
\begin{Verbatim}[frame=single,commandchars=\\\{\}]
git status
git diff
\end{Verbatim}

\onslide<+->
反而改乱了，想回到上次提交时的状态
\begin{Verbatim}[frame=single,commandchars=\\\{\}]
git reset --hard
\end{Verbatim}
注意：刚才所修改的内容都丢弃了
\end{frame}

\begin{frame}[<+->][fragile]{另辟蹊径}
\onslide<+->
想给当前的项目增加新功能，有不想影响正在进行的工作
\begin{Verbatim}[frame=single,commandchars=\\\{\}]
git branch newfeature
git checkout newfeature
\end{Verbatim}

已经另建了一个分支，并且转移到新的分支上。

\onslide<+->
修改
\begin{Verbatim}[frame=single,commandchars=\\\{\}]
vi main.c
vi common.c
\end{Verbatim}

\onslide<+->
把修改过的文件提交到仓库
\begin{Verbatim}[frame=single,commandchars=\\\{\}]
git add main.c
git add common.c
git commit -m 'Some function is added.'
\end{Verbatim}

这是在新的分支上的一个提交，不影响原来的分支。
\end{frame}

\begin{frame}
    \includegraphics<1>[width=7cm]{figure/setup-new-branch.png}
    \includegraphics<2>[width=8cm]{figure/setup-new-branch-2.png}
    \includegraphics<3>[width=8cm]{figure/setup-new-branch-3.png}
\end{frame}

\begin{frame}[fragile]{提交命令的变化}
刚才的命令
\onslide<+->
\begin{Verbatim}[frame=single,commandchars=\\\{\}]
git add main.c
git add common.c
git commit -m 'Some function is added.'
\end{Verbatim}

\onslide<+->
这等同于
\begin{Verbatim}[frame=single,commandchars=\\\{\}]
git commit -a -m 'Some function is added.'
\end{Verbatim}
\end{frame}

\begin{frame}[<+->][fragile]{在编辑器中输入提交注释}
\onslide<+->
提交时的注释很重要，也可以不在命令行中输入，而是在一个编辑器中输入。
\begin{Verbatim}[frame=single,commandchars=\\\{\}]
git commit
\end{Verbatim}

\onslide<+->
缺省编辑器的配置
\begin{Verbatim}[frame=single,commandchars=\\\{\}]
git config --global core.editor vim
\end{Verbatim}
\end{frame}

\begin{frame}[<+->][fragile]{切换分支}
\onslide<+->
你正在newfeature分支上工作。临时要处理master分支中的一个问题。
当前工作先提交
\begin{Verbatim}[frame=single,commandchars=\\\{\}]
git commit -a
\end{Verbatim}

\onslide<+->
切换分支
\begin{Verbatim}[frame=single,commandchars=\\\{\}]
git checkout master
\(\cdots\)
git commit -a
\end{Verbatim}

\onslide<+->
切换回来
\begin{Verbatim}[frame=single,commandchars=\\\{\}]
git checkout newfeature
\(\cdots\)
git commit -a
\end{Verbatim}
\end{frame}

\begin{frame}[<+->][fragile]{分支合并}
\onslide<+->
经过一段时间的修改，你认为你的newfeature分支已经做的不错。可以合并到master分支中来了。
\begin{Verbatim}[frame=single,commandchars=\\\{\}]
git checkout master
\end{Verbatim}

\onslide<+->
\begin{Verbatim}[frame=single,commandchars=\\\{\}]
git merge newfuture
\end{Verbatim}

一切顺利的话，就会自动产生一个合并后的新提交。
\end{frame}

\begin{frame}
    \includegraphics<1>[width=9cm]{figure/merge-1.png}
    \includegraphics<2>[width=9cm]{figure/merge-2.png}
\end{frame}

\begin{frame}[fragile]{解决合并时的冲突}
合并产生冲突时，会出现冲突提示。

这时需要手工解决冲突，然后提交
\begin{Verbatim}[frame=single,commandchars=\\\{\}]
vim main.c
\(\cdots\)
git add main.c
git commit
\end{Verbatim}
\end{frame}

\begin{frame}
    \includegraphics<1>[width=9cm]{figure/resolve-conflict-1.png}
    \includegraphics<2>[width=9cm]{figure/resolve-conflict-2.png}
    \includegraphics<3>[width=9cm]{figure/resolve-conflict-2.png}
\end{frame}
